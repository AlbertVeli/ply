<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>ply</title>

    <!-- Bootstrap Core CSS - Uses Bootswatch Flatly Theme: http://bootswatch.com/flatly/ -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/freelancer.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body id="page-top" class="index">
    <header>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <img class="img-responsive" src="img/profile.png" alt="">
                    <div class="intro-text">
                        <span class="name">ply</span>
                        <hr class="star-light">
                        <span class="skills">Light-Weight Dynamic Tracing for Linux</span>
                    </div>
                </div>
            </div>
	    <div class="row">
                <div class="col-lg-3 col-lg-offset-3 text-center">
                    <a href="https://github.com/wkz/ply" class="btn btn-lg btn-outline">
                        <i class="fa fa-github"></i> Fork on Github
                    </a>
                </div>
                <div class="col-lg-3 text-center">
                    <a href="ply.1.html" class="btn btn-lg btn-outline">
                        <i class="fa fa-book"></i> Read the Manual
                    </a>
                </div>
            </div>
        </div>
    </header>

    <section id="Highlights">
        <div class="container">
            <div class="row">
                <div class="col-sm-4 text-center">
		  <i class="fa fa-heart fa-3x"></i>
		  <h3>Approachable</h3>
		  <p class="text-justify">
		    The syntax is inspired by UNIX's "little
		    languages" of yore, such as awk. Thus, people who
		    have written an awk script should be able to
		    effortlessly write ply scripts. Variables are
		    declared and their types inferred automatically,
		    making iterating on scripts fast and easy.
		  </p>
                </div>
                <div class="col-sm-4 text-center">
		  <i class="fa fa-terminal fa-3x"></i>
		  <h3>Light-Weight</h3>
		  <p class="text-justify">
		    Designed with embedded systems in mind. Written in
		    C, all ply needs to run is libc and a modern
		    kernel with Linux BPF support. No external kernel
		    modules, no LLVM compiler, no python
		    inerpreter. It is also very easy to add support
		    for new architectures.
		  </p>
                </div>
                <div class="col-sm-4 text-center">
		  <i class="fa fa-rocket fa-3x"></i>
		  <h3>Efficient</h3>
		  <p class="text-justify">
		    All data gathering and aggregation is done in the
		    kernel using Linux BPF programs that are JIT
		    compiled to native instructions on most common
		    architectures. This means that ply runs with very
		    low overhead, allowing it to probe even the
		    hottest code paths.
		  </p>
                </div>
	    </div>
        </div>
    </section>

    <section class="success" id="examples">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 text-center">
            <h2>What Can You Do With it?</h2>
            <hr class="star-light">
          </div>
        </div>
      </div>
    </section>

    <section class="" id="examples">
        <div class="container">
	    <div class="row text-center">
	      <h3>Counting Syscalls</h3>
	    </div>
            <div class="row text-justify">
              <div class="col-lg-4 col-lg-offset-2">
		<pre>#!/usr/bin/env ply

kprobe:SyS_*
{
    $syscalls[func].count()
}</pre>
                <p>
		  This probe will be attached to all functions whose
		  name starts with <code>SYS_</code>, i.e. all
		  syscalls. On each syscall, the probe will fire and
		  index into the user-defined
		  map <code>$syscalls</code> using the built-in
		  variable <code>func</code> as the key and bump a
		  counter.
		</p>
		<p>
		  ply will compile the script, attach it to the
		  matching probes and start collecting data. On exit,
		  ply will dump the values of all user-defined
		  variables and maps.
		</p>
              </div>
              <div class="col-lg-4">
		<pre>wkz@wkz-box:~$ sudo ./syscall-count.ply
331 probes active
^Cde-activating probes

$syscalls:
sys_mprotect                   1
sys_readv                      1
sys_newlstat                   1
sys_access                     2
sys_bind                       3
sys_getsockname                3
sys_rt_sigaction               4
sys_ftruncate                  4
sys_unlink                     4
sys_pselect6                   4
sys_timerfd_settime            4
sys_dup                        5
sys_fdatasync                  5
sys_lseek                     17
sys_inotify_add_watch         21

[ ... output redacted for clarity ... ]

sys_select                 14624
sys_munmap                 14778
sys_mmap_pgoff             14887
sys_epoll_wait             14898
sys_writev                 19516
sys_write                  22644
sys_read                   28700
sys_poll                   53401
sys_futex                  78401
sys_ioctl                 146141
sys_recvmsg               181933</pre>
              </div>
	    </div>
	    <div class="row text-center">
	      <h3>Read Size Distribution</h3>
	    </div>
            <div class="row text-justify">
              <div class="col-lg-4 col-lg-offset-2">
		<pre>#!/usr/bin/env ply

kprobe:SyS_read
{
    $sizes.quantize(arg(2))
}</pre>
                <p>
		  This example shows a very simple script that
		  instruments the <code>read(2)</code> syscall and
		  records the distribution of the <code>size</code>
		  argument, i.e. argument 2 (zero indexed), into the
		  user-defined variable <code>$sizes</code>.
		</p>
              </div>
              <div class="col-lg-4">
		<pre>wkz@wkz-box:~$ sudo ./read-dist.ply
1 probe active
^Cde-activating probes

$sizes:
[   0,    1]        2089
[   2,    4)         434
[   4,    8)        6334
[   8,   16)        9738
[  16,   32)        1645
[  32,   64)          16
[  64,  128)          24
[ 128,  256)          63
[ 256,  512)         102
[ 512,   1k)         200
[  1k,   2k)         433
[  2k,   4k)         750
[  4k,   8k)        1492
[  8k,  16k)        1157
[ 16k,  32k)        5703
[ 32k,  64k)          26
[ 64k, 128k)          48</pre>
              </div>
	    </div>
	    <div class="row text-center">
	      <h3>Socket Buffer tracking</h3>
	    </div>
            <div class="row text-justify">
              <div class="col-lg-4 col-lg-offset-2">
		<pre>#!/usr/bin/env ply

kprobe:__netif_receive_skb_core
{
	$rx[arg(0)] = nsecs;
}

kprobe:ip_rcv / $rx[arg(0)] /
{
	$t.quantize(nsecs - $rx[arg(0)]);
	$rx[arg(0)] = nil;
}
</pre>
                <p>
		  Record the distribution of the time it takes
		  an <code>skb</code> to move
		  from <code>__netif_receive_skb_core</code>
		  to <code>ip_rcv</code>.
		</p>
		<p>
		  In the first probe, a
		  timestamp is stored in <code>$rx</code> using
		  the <code>skb</code> pointer as the key. The second
		  probe is then allowed to run if
		  that <code>skb</code> is a valid key
		  in <code>$rx</code>.
		</p>
		<p>
		  Then the difference with the current timestamp is
		  calculated and its distribution stored
		  in <code>$t</code>. As a final step, the original
		  timestamp is removed so that the map will not fill
		  up with useless entries.
		</p>
		<p>
		  Notice that the unit here is nanoseconds. For
		  example, the median time in this case lays somewhere
		  between 1 and 2 microseconds (1-2k nanoseconds).
		</p>
              </div>
              <div class="col-lg-4">
		<pre>wkz@wkz-box:~$ sudo ./skb-track.ply
2 probes active
^Cde-activating probes

$rx:

$t:
[ 512,   1k)	    1041
[  1k,   2k)	    5972
[  2k,   4k)	    3439
[  4k,   8k)	     655
[  8k,  16k)	      39
[ 16k,  32k)	       2
[ 32k,  64k)	      10
[ 64k, 128k)	       1
[  1M,   2M)	       1
</pre>
              </div>
	    </div>
     </section>

    <section class="success" id="examples">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 text-center">
            <h2>What Can't You Do With it?</h2>
            <hr class="star-light">
          </div>
        </div>
      </div>
    </section>

    <section class="" id="examples">
      <div class="container">
        <div class="col-lg-4 col-lg-offset-2">
          <p>
	    At the moment, any data that is not available as a
	    built-in function in ply, or in a CPU register is out of
	    reach. That means no stack variables, no pointer
	    de-referencing, no type-casting.
	  </p>
          <p>
	    ply is intended to be a light-weight tool, useful for
	    exploratory probing. It is a very young project and
	    by <em>no</em> means a complete tracer.
	  </p>
        </div>
        <div class="col-lg-4">
          <p>
	    For more explicit control of instrumentation, data
	    processing, and presentation have a look at the bcc
	    project.
	  </p>
	  <p>
	    It uses an LLVM based C back-end and a Python
	    front-end. With it you can write kprobe tracepoints, tc
	    filters and much more.
	  </p>
	  <p>
	    <a href="https://github.com/iovisor/bcc" class="btn btn-lg btn-outline-success">
              <i class="fa fa-github"></i> bcc on Github
            </a>
	  </p>
        </div>
      </div>
    </section>	

    <!-- Footer -->
    <footer class="text-center">
        <div class="footer-below">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                      <p>
			<small>
			  Copyright &copy; Tobias Waldekranz 2016
			</small>
		      </p>
		      <p>
			<small>
			  The Linux BPF Pony was created by Deirdré
			  Straughan using General Zoi's pony creator.
			</small>
		      </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="js/classie.js"></script>
    <script src="js/cbpAnimatedHeader.js"></script>

    <!-- Contact Form JavaScript -->
    <script src="js/jqBootstrapValidation.js"></script>
    <script src="js/contact_me.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="js/freelancer.js"></script>

</body>

</html>
